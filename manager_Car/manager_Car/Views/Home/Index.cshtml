<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng Tổng Kết Điểm</title>

    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- jQuery: LUÔN PHẢI LOAD ĐẦU TIÊN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>


    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
</head>
<body>
    <div class="header">
        <h2 style="text-align:center">Bảng tổng kết điểm <span style="color:#0dcaf0!important"> DARK NIGHT [1-1]</span></h2>
        <p style="text-align:center;font-weight:600">[Chốt điểm 23h59 ngày <span id="chotDiemDate"></span>]</p>
        <div class="row">
            <i>
             - Bấm
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path>  <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path></svg> xem lịch sử lịch trước khi thắc mắc điểm
            </i>
        </div>
        <div class="row">
            <i>
                - Mua điểm ib zalo <a href="https://id.zalo.me/account?continue=https://chat.zalo.me">Thu Điểm Dark Night</a>
            </i>
        </div>
        <div class="row">
			<div style="display:flex">
                <i>- Chọn ngày chốt điểm: </i>
                    <input type="text" id="inputDate"  style="height: 25px;margin-left:5px" />
            </div>
         
        </div>
    </div>
    <div class="table-container">
        <table id="darkNightTable" class="display">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Tên Zalo</th>
                    <th>Điểm</th>
                    <th>Tiền Thưởng</th>
                    <th>Trạng Thái</th>
                </tr>
            </thead>
            <tbody></tbody> <!-- Dữ liệu sẽ được thêm động -->
        </table>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Lịch sử lịch gần đây </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="historyContent">
                    <p><strong>[ <span id="nameUser" style="color:#0dcaf0"> A Luân</span> ]</strong></p>

                    <!-- Chốt điểm -->
                    <p> <span class="text-warning "> >></span> Chốt điểm đến 23h59 ngày 01/07/2025 : <span class="text-warning fw-bold">1.5 đ</span></p>
                    <p> <span class="text-warning "> >></span> Chốt điểm đến 23h59 ngày 14/06/2025 : <span class="text-warning fw-bold">1.5 đ</span></p>

                    <!-- Lịch chi tiết -->
                    <div class="border rounded p-2 mb-3">
                        <p class="mb-1"><strong>14/06/2025</strong> &nbsp; <span class="text-primary fw-bold">+0.5</span></p>
                        <p class="mb-1"><strong>Nhận sân</strong> - <strong>Lâm Vũ</strong></p>
                        <p class="text-muted mb-0">San  Luân 0,5d ktly</p>
                    </div>

                    <p> <span class="text-warning "> >></span> Chốt điểm đến 23h59 ngày 13/06/2025 : <span class="text-warning fw-bold">1 đ</span></p>

                    <div class="border rounded p-2 mb-3">
                        <p class="mb-1"><strong>13/06/2025</strong> &nbsp; <span class="text-danger fw-bold">-0.5</span></p>
                        <p class="mb-1"><strong>Nhận lịch</strong> - <strong>Lâm Vũ</strong></p>
                        <p class="text-muted mb-0">Ycau carnival 7s tiến tới nay 22h greenpark yên hoà sau đó qua 381 nguyễn khang ck450 0,5</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // Call api import excel
            $('#uploadBtn').click(function () {
                var fileInput = $('#excelFile')[0];
                var file = fileInput.files[0];

                if (!file) {
                    alert('Please choose a file!');
                    return;
                }

                var formData = new FormData();
                formData.append("file", file);

                $.ajax({
                    url: "/api/Manager/import-transactions",
                    type: "POST",
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        $('#uploadResult').html('<span style="color:green;">✅ Success: ' + response + '</span>');
                    },
                    error: function (xhr) {
                        $('#uploadResult').html('<span style="color:red;">❌ Error: ' + xhr.responseText + '</span>');
                    }
                });
            });

            $('#inputDate').datepicker({
                format: 'dd/mm/yyyy',
                autoclose: true,
                language: 'vi', // Vietnamese localization
                todayHighlight: true
            }).on('changeDate', function (e) {
                // Update chotDiemDate span with the selected date
                const selectedDate = e.format('dd/mm/yyyy');
                $('#chotDiemDate').text(selectedDate);
            });
            // Tính ngày chốt điểm (hôm nay - 1 ngày)
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            const formattedDate = `${yesterday.getDate().toString().padStart(2, '0')}/${(yesterday.getMonth() + 1).toString().padStart(2, '0')}/${yesterday.getFullYear()}`;
            $('#chotDiemDate').text(formattedDate);

            // Dữ liệu giả lập
            const data = [
                { name: "A A Quang Xe", points: 0, reward: "0K", id: 1828 },
                { name: "A Erik Nguyễn", points: 3, reward: "420K", id: 1829 },
                { name: "A Huy", points: 0, reward: "0K", id: 1830 },
                { name: "A Luân", points: 1.5, reward: "210K", id: 1831 },
                { name: "A Nghiệm Thành Đạt", points: 0, reward: "0K", id: 1832 },
                { name: "A Tóc Suông Lủi", points: 31.25, reward: "4375K", id: 1833 },
                { name: "A Đức Airpot", points: 1, reward: "140K", id: 1834 },
                { name: "ABC", points: 6.5, reward: "910K", id: 1835 },
                { name: "Ae Chạy Xe Sáng Và Đường Dài", points: 8.5, reward: "1190K", id: 1836 },
                { name: "Ah Quang", points: 13.25, reward: "1855K", id: 1837 },
                { name: "Airport Car Operator", points: 1.5, reward: "210K", id: 1838 }
            ];

            // Khởi tạo DataTable với dữ liệu
            const table = $('#darkNightTable').DataTable({
                language: {
                        "decimal": "",
                        "emptyTable": "Không có dữ liệu",
                        "info": "Hiển thị _START_ đến _END_ của _TOTAL_ bản ghi",
                        "infoEmpty": "Hiển thị 0 đến 0 của 0 bản ghi",
                        "infoFiltered": "(lọc từ _MAX_ bản ghi)",
                        "infoPostFix": "",
                        "thousands": ",",
                        "lengthMenu": "Hiển thị _MENU_ bản ghi",
                        "loadingRecords": "Đang tải...",
                        "processing": "Đang xử lý...",
                        "search": "Tìm kiếm:",
                        "zeroRecords": "Không tìm thấy bản ghi nào",
                        "paginate": {
                            "first": "<<",
                            "last": ">>",
                            "next": ">",
                            "previous": "<"
                        }
                    },
                data: data,
                columns: [
                    {
                        data: null,
                        render: function (data, type, row, meta) {
                            return meta.row + 1; // Tự động đánh số thứ tự
                        }
                    },
                    { data: "name" },
                    { data: "points" },
                    { data: "reward" },
                    {
                        data: null,
                        render: function (data, type, row) {
                            const nameEscaped = data.name.replace(/'/g, "\\'");
                            return `<button class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="showHistory(${data.id}, '${nameEscaped}');"><span style="color:white"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"></path></svg></span></button>`;
                        }
                    }
                ],
                paging: true,
                searching: true,
                info: false
            });

            window.showHistory = function (id,name) {
                // const historyData = `Lịch sử cho ${name}: Dữ liệu giả lập - [Thời gian: ${formattedDate}, Điểm: 5, Ghi chú: Hoàn thành].`;
                // $('#historyContent').text(historyData);
                document.getElementById('nameUser').textContent = name;
                $('#exampleModal').modal('show');
            };
        });
     
      
    </script>
</body>
</html>